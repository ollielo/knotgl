<!DOCTYPE html>
<html>
<head>
<title>KnotGL</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/jquery.gritter.css" />
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/jquery.gritter.js"></script>
<script type="text/javascript" src="js/gl-matrix-min.js"></script>
<script type="text/javascript" src="js/application.js"></script>

<!-- VERTEX SHADER -->
<script id="VS-Scene" type="x-shader/x-vertex">
attribute vec4 Position;
attribute vec3 Normal;
uniform mat4 Modelview;
uniform mat4 Projection;
uniform mat3 NormalMatrix;
varying vec3 vPosition;
varying vec3 vNormal;
void main(void)
{
    vPosition = (Modelview * Position).xyz;
    vNormal = NormalMatrix * Normal;
    gl_Position = Projection * Modelview * Position;
}
</script>

<!-- FRAGMENT SHADER -->
<script id="FS-Scene" type="x-shader/x-fragment">
varying highp vec3 vNormal;
varying highp vec3 vPosition;
void main()
{
    highp vec3 N = normalize(vNormal);
    highp vec3 P = vPosition;
    highp vec3 I = normalize(P);
    highp float cosTheta = abs(dot(I, N));
    highp float fresnel = pow(1.0 - cosTheta, 3.0);
    highp float depth = gl_FrontFacing ? gl_FragCoord.z : -gl_FragCoord.z;
    gl_FragColor = vec4(depth, fresnel, 0, 1);
}
</script>

<!-- SHADER UTILITIES -->
<script type="text/javascript">
function getShader(gl, id)
{
    var shaderScript = document.getElementById(id);
    var shader;
    if (shaderScript.type == "x-shader/x-fragment")    shader = gl.createShader(gl.FRAGMENT_SHADER);
    else if (shaderScript.type == "x-shader/x-vertex") shader = gl.createShader(gl.VERTEX_SHADER);
    gl.shaderSource(shader, shaderScript.innerText);
    gl.compileShader(shader);
    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        $.gritter.add({title: 'GLSL Error with ' + id, text: gl.getShaderInfoLog(shader) });
        return null;
    }
    return shader;
}
function glerr(msg)
{
    $.gritter.add({ title: 'WebGL Error', text: msg });
}
function glinfo(msg)
{
    $.gritter.add({ title: 'General Notice', text: msg });
}
</script>
</head>

<!-- WEB PAGE BODY -->
<body onload="window.AppInit();">
  <canvas width="682" height="512" style="width: 682px; height: 512px;">
  </canvas>
</body>
</html>
