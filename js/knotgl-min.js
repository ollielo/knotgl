(function(){var u,C,v,o,w,x,y,z,t,D,c,A;c="undefined"!==typeof exports&&null!==exports?exports:this;x=function(c){var a,h;if(null==c||"object"!==typeof c)return c;h=new c.constructor;for(a in c)h[a]=x(c[a]);return h};c.AppInit=function(){var f,a,h;f=$("canvas").get(0).getContext("experimental-webgl",{antialias:!0});f.getExtension("OES_texture_float")||glerr("Your browser does not support floating-point textures.");f.getExtension("OES_standard_derivatives")||glerr("Your browser does not support GLSL derivatives.");
h=parseInt($("#overlay").css("width"));a=parseInt($("#overlay").css("height"));return c.renderer=new c.Renderer(f,h,a)};C={crossings:2,numComponents:1,index:1};v={crossings:100,numComponents:50,index:50};c.Numerals={size:x(v),text:{},dirty:{}};c.UpdateNumeralSizes=function(){$("#crossings").css("font-size",c.Numerals.size.crossings);$("#superscript").css("font-size",c.Numerals.size.numComponents);return $("#subscript").css("font-size",c.Numerals.size.index)};c.UpdateNumerals=function(){UpdateNumeralSizes();
$("#crossings").text(c.Numerals.text.crossings);$("#subscript").text(c.Numerals.text.index);return $("#superscript").text(c.Numerals.text.numComponents)};c.OnKeyDown=function(f){var a,h;"left"===f&&c.renderer.changeSelection(-1);"right"===f&&c.renderer.changeSelection(1);h=c.renderer.getCurrentLink().split(".");f=h[0];a=h[1];h=h[2];1===a&&(a="");c.Numerals.dirty.crossings=c.Numerals.text.crossings!==f;c.Numerals.dirty.numComponents=c.Numerals.text.numComponents!==a;c.Numerals.dirty.index=c.Numerals.text.index!==
h;c.Numerals.text.crossings=f;c.Numerals.text.numComponents=a;c.Numerals.text.index=h;a=0.25*c.renderer.transitionMilliseconds;f=(new TWEEN.Tween(c.Numerals.size)).to(C,a).easing(TWEEN.Easing.Quintic.In).onUpdate(c.UpdateNumeralSizes);a=(new TWEEN.Tween(c.Numerals.size)).to(v,a).easing(TWEEN.Easing.Quintic.In).onUpdate(c.UpdateNumerals);f.chain(a);return f.start()};c="undefined"!==typeof exports&&null!==exports?exports:this;c.links=[["0.1"],["3.1",[3042,47]],["4.1",[1375,69]],["5.1",[7357,69]],["5.2",
[1849,81]],["6.1",[1534,96]],["6.2",[0,82]],["6.3",[10652,85]],["7.1",[7845,94]],["7.2",[5595,86]],["7.3",[190,122]],["7.4",[3640,102]],["7.5",[1751,98]],["7.6",[5020,102]],["7.7",[9660,91]],["8.1",[1279,96]],["8.2",[9751,108]],["8.3",[2817,112]],["8.4",[3938,105]],["8.5",[4043,105]],["8.6",[4623,90]],["8.7",[1191,88]],["8.8",[5681,100]],["8.9",[1930,98]],["8.10",[9031,85]],["8.11",[1444,90]],["8.12",[4828,94]],["8.13",[6231,90]],["8.14",[885,98]],["8.15",[9574,86]],["8.16",[4148,85]],["8.17",[312,
81]],["8.18",[2243,97]],["8.19",[6321,86]],["8.20",[7529,88]],["8.21",[686,89]],["9.1",[7013,102]],["9.2",[10544,108]],["9.3",[4922,98]],["9.4",[3322,89]],["9.5",[3411,114]],["9.6",[8182,98]],["9.7",[592,94]],["9.8",[10353,91]],["9.9",[2140,103]],["9.10",[8392,112]],["9.11",[9349,120]],["9.12",[2929,113]],["9.13",[9116,123]],["9.14",[3089,102]],["9.15",[7939,116]],["9.16",[5462,133]],["9.17",[10242,111]],["9.18",[82,108]],["9.19",[5122,118]],["9.20",[7725,120]],["9.21",[486,106]],["9.22",[1630,121]],
["9.23",[2436,113]],["9.24",[775,110]],["9.25",[6601,102]],["9.26",[3525,115]],["9.27",[6407,89]],["9.28",[7426,103]],["9.29",[8280,112]],["9.30",[5781,111]],["9.31",[6703,120]],["9.32",[8055,127]],["9.33",[7227,130]],["9.34",[4713,115]],["9.35",[3191,131]],["9.36",[5240,119]],["0.2.1"],["2.2.1",[2648,36],[2684,36]],["4.2.1",[10161,39],[10200,42]],["5.2.1",[8728,38],[8766,39]],["6.2.1",[8931,49],[8980,51]],["6.2.2",[2340,47],[2387,49]],["6.2.3",[3742,41],[3783,54]],["7.2.1",[9859,44],[9903,55]],["7.2.2",
[393,45],[438,48]],["7.2.3",[6928,39],[6967,46]],["7.2.4",[6496,77],[6573,28]],["7.2.5",[5892,45],[5937,68]],["7.2.6",[6823,27],[6850,78]],["7.2.7",[10057,78],[10135,26]],["7.2.8",[9239,43],[9282,67]],["8.2.1",[7115,58],[7173,54]],["8.2.2",[6005,53],[6058,59]],["8.2.3",[8504,42],[8546,63]],["8.2.4",[4357,50],[4407,57]],["8.2.5",[9958,51],[10009,48]],["8.2.6",[10444,46],[10490,54]],["8.2.7",[5359,47],[5406,56]],["8.2.8",[1097,50],[1147,44]],["8.2.9",[2028,42],[2070,70]],["8.2.10",[4233,96],[4329,28]],
["8.2.11",[6117,93],[6210,21]],["0.3.1"],["6.3.1",[3837,37],[3874,31],[3905,33]],["6.3.2",[9469,38],[9507,34],[9541,33]],["6.3.3",[2720,35],[2755,30],[2785,32]],["7.3.1",[7617,44],[7661,33],[7694,31]],["8.3.1",[8805,45],[8850,49],[8899,32]],["8.3.2",[8609,45],[8654,48],[8702,26]],["8.3.3",[983,43],[1026,36],[1062,35]],["8.3.4",[4464,28],[4492,29],[4521,102]],["8.3.5",[2549,26],[2575,29],[2604,44]]];c="undefined"!==typeof exports&&null!==exports?exports:this;u=1;o=function(){function f(a,h,b){this.gl=
a;this.width=h;this.height=b;this.radiansPerSecond=3.0E-4;this.transitionMilliseconds=750;this.spinning=!0;this.style=u;this.sketchy=!0;this.theta=0;this.vbos={};this.programs={};this.selectionIndex=0;this.tubeGen=new c.TubeGenerator;this.tubeGen.polygonSides=10;this.tubeGen.b\u00e9zierSlices=3;this.tubeGen.tangentSmoothness=3;this.compileShaders();this.gl.disable(this.gl.CULL_FACE);this.gl.getError()!==this.gl.NO_ERROR&&glerr("OpenGL error during init");this.downloadSpines()}f.name="Renderer";f.prototype.onDownloadComplete=
function(a){this.spines=new Float32Array(a.centerlines);this.vbos.spines=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbos.spines);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.spines,this.gl.STATIC_DRAW);this.gl.getError()!==this.gl.NO_ERROR&&glerr("Error when trying to create spine VBO");toast("downloaded "+this.spines.length/3+" verts of spine data");this.genVertexBuffers();return this.render()};f.prototype.getCurrentLink=function(){return this.links[this.selectionIndex].id};
f.prototype.changeSelection=function(a){var h,b;h=this.selectionIndex;b=h+a;if(!(b>=this.links.length||0>b))if(a=this.links[h].iconified,0===a)this.selectionIndex=b,c.outgoing=(new TWEEN.Tween(this.links[h])).to({iconified:1},0.5*this.transitionMilliseconds).easing(TWEEN.Easing.Quartic.Out),c.incoming=(new TWEEN.Tween(this.links[b])).to({iconified:0},this.transitionMilliseconds).easing(TWEEN.Easing.Bounce.Out),c.incoming.start(),c.outgoing.start();else return this.selectionIndex=b,this.links[h].iconified=
1,this.links[b].iconified=a,c.incoming.replace(this.links[b])};f.prototype.downloadSpines=function(){var a;a=new Worker("js/downloader.js");a.renderer=this;a.onmessage=function(a){return this.renderer.onDownloadComplete(a.data)};return a.postMessage(document.URL+"data/centerlines.bin")};f.prototype.compileShaders=function(){var a,h,b,e,r,d;r=c.shaders;d=[];for(b in r)h=r[b],"source"!==b&&(a=h.keys,e=a[0],a=a[1],d.push(this.programs[b]=this.compileProgram(e,a,h.attribs,h.uniforms)));return d};f.prototype.render=
function(){var a,h,b,e,r,d,i;window.requestAnimationFrame(function(){return c.renderer.render()},$("canvas").get(0));TWEEN.update();a=(new Date).getTime();null!=this.previousTime&&(h=a-this.previousTime,this.spinning&&(this.theta+=this.radiansPerSecond*h));this.previousTime=a;this.projection=mat4.perspective(45,this.width/this.height,5,90);h=mat4.lookAt([0,-5,5],[0,0,0],[0,1,0]);a=mat4.create();this.modelview=mat4.create();mat4.identity(a);mat4.rotateX(a,0.785);mat4.rotateY(a,this.theta);mat4.multiply(h,
a,this.modelview);this.normalMatrix=mat4.toMat3(this.modelview);h=b=0;for(d=this.links.length;0<=d?b<d:b>d;h=0<=d?++b:--b){i=this.links[h];e=0;for(r=i.length;e<r;e++)a=i[e],this.renderKnot(a,h)}if(this.gl.getError()!==this.gl.NO_ERROR)return glerr("Render")};f.prototype.renderKnot=function(a,h){var b,e,c,d,i,j,g,f,m,l,k,p;this.gl.setColor=function(b,d){return this.uniform4f(b,a.color[0],a.color[1],a.color[2],d)};g=this.width/9;64>g&&(g=64);128<g&&(g=128);b=(9*g-this.width)/4;0>b&&(b=0);e=0.5*(this.width-
9*(g-b))-g/2;0>e&&(e=0);j=g*this.height/this.width;e+=(g-b)*h;c=this.links[h].iconified;b=0.25+0.75*c;this.gl.viewport(e,this.height-j,g,j);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);d=this.programs.wireframe;this.gl.useProgram(d);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbos.spines);this.gl.enableVertexAttribArray(POSITION);this.gl.vertexAttribPointer(POSITION,3,this.gl.FLOAT,!1,12,0);this.gl.uniformMatrix4fv(d.projection,!1,this.projection);
this.gl.uniformMatrix4fv(d.modelview,!1,this.modelview);this.gl.uniform1f(d.scale,this.tubeGen.scale);this.gl.uniform4f(d.color,0,0,0,b);f=a.centerline;i=f[0];f=f[1];this.gl.enable(this.gl.DEPTH_TEST);this.gl.lineWidth(2);for(m=k=-1;1>=k;m=k+=2)for(l=p=-1;1>=p;l=p+=2)this.gl.uniform2f(d.offset,m,l),this.gl.uniform1f(d.depthOffset,0),this.gl.drawArrays(this.gl.LINE_LOOP,i,f);this.gl.enable(this.gl.BLEND);this.gl.lineWidth(2);this.gl.setColor(d.color,b);this.gl.uniform2f(d.offset,0,0);this.gl.uniform1f(d.depthOffset,
-0.5);this.gl.drawArrays(this.gl.LINE_LOOP,i,f);this.gl.disableVertexAttribArray(POSITION);this.gl.viewport(0,0,this.width,this.height);d.color[3]=1;b=1-c;this.gl.viewport((1-b)*e,(1-b)*(this.height-j),b*this.width+(1-b)*g,b*this.height+(1-b)*j);d=this.programs.solidmesh;this.gl.enable(this.gl.DEPTH_TEST);this.gl.useProgram(d);this.gl.setColor(d.color);this.gl.uniformMatrix4fv(d.projection,!1,this.projection);this.gl.uniformMatrix4fv(d.modelview,!1,this.modelview);this.gl.uniformMatrix3fv(d.normalmatrix,
!1,this.normalMatrix);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.tube);this.gl.enableVertexAttribArray(POSITION);this.gl.enableVertexAttribArray(NORMAL);this.gl.vertexAttribPointer(POSITION,3,this.gl.FLOAT,!1,24,0);this.gl.vertexAttribPointer(NORMAL,3,this.gl.FLOAT,!1,24,12);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.triangles);this.style===u&&(this.gl.enable(this.gl.POLYGON_OFFSET_FILL),this.gl.polygonOffset(-1,12));this.gl.drawElements(this.gl.TRIANGLES,a.triangles.count,this.gl.UNSIGNED_SHORT,
0);this.gl.disableVertexAttribArray(POSITION);this.gl.disableVertexAttribArray(NORMAL);this.gl.disable(this.gl.POLYGON_OFFSET_FILL);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);d=this.programs.wireframe;this.gl.useProgram(d);this.gl.uniformMatrix4fv(d.projection,!1,this.projection);this.gl.uniformMatrix4fv(d.modelview,!1,this.modelview);this.gl.uniform1f(d.scale,1);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.tube);this.gl.enableVertexAttribArray(POSITION);
this.gl.vertexAttribPointer(POSITION,3,this.gl.FLOAT,!1,24,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.wireframe);0===this.style?(this.gl.lineWidth(1),this.gl.uniform1f(d.depthOffset,-0.01),this.gl.uniform4f(d.color,0,0,0,0.75),this.gl.drawElements(this.gl.LINES,a.wireframe.count,this.gl.UNSIGNED_SHORT,0)):2===this.style?(this.gl.lineWidth(1),this.gl.uniform1f(d.depthOffset,-0.01),this.gl.uniform4f(d.color,0,0,0,0.75),this.gl.drawElements(this.gl.LINES,a.wireframe.count/2,this.gl.UNSIGNED_SHORT,
a.wireframe.count)):(this.gl.lineWidth(2),this.gl.uniform1f(d.depthOffset,0.01),this.gl.uniform4f(d.color,0,0,0,1),this.gl.drawElements(this.gl.LINES,a.wireframe.count,this.gl.UNSIGNED_SHORT,0),this.sketchy&&(this.gl.lineWidth(1),this.gl.uniform4f(d.color,0.1,0.1,0.1,1),this.gl.uniform1f(d.depthOffset,-0.01),this.gl.drawElements(this.gl.LINES,a.wireframe.count/2,this.gl.UNSIGNED_SHORT,a.wireframe.count)));return this.gl.disableVertexAttribArray(POSITION)};f.prototype.getLink=function(a){var h,b,e,
r,d;r=c.links;d=[];b=0;for(e=r.length;b<e;b++)h=r[b],h[0]===a&&d.push(h.slice(1));return d[0]};f.prototype.genVertexBuffers=function(){var a,h,b,e,c;this.links=[];c="7.2.3 7.2.4 7.2.5 7.2.6 7.2.7 7.2.8 8.2.1 8.2.2 8.2.3".split(" ");b=0;for(e=c.length;b<e;b++){h=c[b];for(var d=void 0,i=void 0,j=void 0,g=void 0,j=this.getLink(h),g=[],d=0,i=j.length;d<i;d++)a=j[d],g.push(this.tessKnot(a));a=g;a[0].color=[1,1,1,0.75];1<a.length&&(a[1].color=[0.25,0.5,1,0.75]);2<a.length&&(a[2].color=[1,0.5,0.25,0.75]);
a.iconified=1;a.id=h;this.links.push(a)}return this.links[0].iconified=0};f.prototype.tessKnot=function(a){var h,b,e,c,d,i,j,g,f,m,l;h=this.tubeGen.getKnotPath(this.spines.subarray(3*a[0],3*a[0]+3*a[1]));j=this.tubeGen.generateTube(h);b=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,b);this.gl.bufferData(this.gl.ARRAY_BUFFER,j,this.gl.STATIC_DRAW);console.log("Tube positions has "+j.length/3+" verts.");m=b;d=h.length/3-1;g=this.tubeGen.polygonSides;j=new Uint16Array(4*d*g);i=[0,0];
b=i[0];for(i=i[1];b<d*(g+1);){for(e=0;e<g;)c=j.subarray(i+2,i+4),c[0]=b+e,c[1]=b+e+g+1,e=[i+2,e+1],i=e[0],e=e[1];b+=g+1}for(b=0;b<d*(g+1);){for(e=0;e<g;)c=j.subarray(i+0,i+2),c[0]=b+e,c[1]=b+e+1,e=[i+2,e+1],i=e[0],e=e[1];b+=g+1}b=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,b);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,j,this.gl.STATIC_DRAW);d=b;d.count=j.length;console.log("Tube wireframe has "+j.length+" indices for "+g+" sides and "+(h.length/3-1)+" polygons.");j=
new Uint16Array(6*h.length/3*g);e=[0,0,0];b=e[0];i=e[1];for(l=e[2];++b<h.length/3;){for(e=-1;++e<g;)c=(e+1)%g,f=j.subarray(i+0,i+3),f[0]=l+c+g+1,f[1]=l+c,f[2]=l+e,f=j.subarray(i+3,i+6),f[0]=l+e,f[1]=l+e+g+1,f[2]=l+c+g+1,i+=6;l+=g+1}b=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,b);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,j,this.gl.STATIC_DRAW);h=b;h.count=j.length;return{centerline:a,tube:m,wireframe:d,triangles:h}};f.prototype.compileProgram=function(a,h,b,e){var f,
d,i,j,g;f=function(a,b,d){a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS))return $.gritter.add({title:"GLSL Error: "+b,text:a.getShaderInfoLog(d)})};d=c.shaders.source[a];g=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(g,d);f(this.gl,a,g);i=c.shaders.source[h];d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,i);f(this.gl,h,d);f=this.gl.createProgram();this.gl.attachShader(f,g);this.gl.attachShader(f,d);for(j in b)g=b[j],this.gl.bindAttribLocation(f,
g,j);this.gl.linkProgram(f);this.gl.getProgramParameter(f,this.gl.LINK_STATUS)||glerr("Could not link "+a+" with "+h);for(j in e)g=e[j],f[g]=this.gl.getUniformLocation(f,j);return f};return f}();c.Renderer=o;o=function(){var c,a,h,b;h=["sin","cos","pow","abs"];b=[];c=0;for(a=h.length;c<a;c++)t=h[c],b.push(Math[t]);return b}();A=o[0];y=o[1];z=vec3.dot;w=2*Math.PI;c="undefined"!==typeof exports&&null!==exports?exports:this;c.shaders={solidmesh:{keys:["VS-Scene","FS-Scene"],attribs:{Position:POSITION,
Normal:NORMAL},uniforms:{Projection:"projection",Modelview:"modelview",NormalMatrix:"normalmatrix",Color:"color"}},wireframe:{keys:["VS-Wireframe","FS-Wireframe"],attribs:{Position:POSITION},uniforms:{Projection:"projection",Modelview:"modelview",DepthOffset:"depthOffset",Offset:"offset",Color:"color",Scale:"scale"}},vignette:{keys:["VS-Vignette","FS-Vignette"],attribs:{VertexID:VERTEXID},uniforms:{Viewport:"viewport"}}};c.shaders.source={};c.shaders.source["VS-Scene"]="attribute vec4 Position;\nattribute vec3 Normal;\nuniform mat4 Modelview;\nuniform mat4 Projection;\nuniform mat3 NormalMatrix;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvoid main(void)\n{\n    vPosition = Position.xyz;\n    vNormal = NormalMatrix * Normal;\n    gl_Position = Projection * Modelview * Position;\n}";
c.shaders.source["VS-Wireframe"]="attribute vec4 Position;\nuniform mat4 Modelview;\nuniform mat4 Projection;\nuniform float DepthOffset;\nuniform float Scale;\nuniform vec2 Offset;\nvoid main(void)\n{\n    vec4 p = Position;\n    p.xyz *= Scale;\n    gl_Position = Projection * Modelview * p;\n    gl_Position.z += DepthOffset;\n    gl_Position.xy += Offset * 0.15;\n}";c.shaders.source["FS-Wireframe"]="precision highp float;\nprecision highp vec3;\nuniform vec4 Color;\nvoid main()\n{\n    gl_FragColor = Color;\n}";
c.shaders.source["FS-Scene"]="precision highp float;\nprecision highp vec3;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvec3 LightPosition = vec3(0.25, 0.5, 1.0);\nvec3 AmbientMaterial = vec3(0.04, 0.04, 0.04);\nvec3 SpecularMaterial = vec3(0.25, 0.25, 0.25);\nvec3 FrontMaterial = vec3(0.25, 0.5, 0.75);\nvec3 BackMaterial = vec3(0.75, 0.75, 0.7);\nfloat Shininess = 50.0;\n\nuniform vec4 Color;\n\nvoid main()\n{\n    vec3 N = normalize(vNormal);\n    if (!gl_FrontFacing)\n        N = -N;\n\n    vec3 L = normalize(LightPosition);\n    vec3 Eye = vec3(0, 0, 1);\n    vec3 H = normalize(L + Eye);\n\n    float df = max(0.0, dot(N, L));\n    float sf = max(0.0, dot(N, H));\n    sf = pow(sf, Shininess);\n\n    vec3 P = vPosition;\n    vec3 I = normalize(P);\n    float cosTheta = abs(dot(I, N));\n    float fresnel = 1.0 - clamp(pow(1.0 - cosTheta, 0.125), 0.0, 1.0);\n\n    vec3 color = !gl_FrontFacing ? FrontMaterial : BackMaterial;\n    color *= Color.rgb;\n    vec3 lighting = AmbientMaterial + df * color;\n    if (gl_FrontFacing)\n        lighting += sf * SpecularMaterial;\n\n    lighting += fresnel;\n    gl_FragColor = vec4(lighting,1);\n}";
c.shaders.source["VS-Vignette"]="attribute vec2 VertexID;\nvoid main(void)\n{\n    vec2 p = 3.0 - 4.0 * VertexID;\n    gl_Position = vec4(p, 0, 1);\n}";c.shaders.source["FS-Vignette"]="precision highp float;\nprecision highp vec2;\n\nuniform vec2 Viewport;\nvoid main()\n{\n    vec2 c = gl_FragCoord.xy / Viewport;\n    float f = 1.0 - 0.5 * pow(distance(c, vec2(0.5)), 1.5);\n    gl_FragColor = vec4(f, f, f, 1);\n    gl_FragColor.rgb *= vec3(0.867, 0.18, 0.447); // Hot Pink!\n}";c="undefined"!==typeof exports&&
null!==exports?exports:this;o=function(){function c(){this.scale=0.15;this.tangentSmoothness=this.b\u00e9zierSlices=3;this.polygonSides=9;this.radius=0.07}c.name="TubeGenerator";c.prototype.getKnotPath=function(a){var c,b,e,f,d,i,j,g,n,m,l,k,p,q,o,s,B;m=this.b\u00e9zierSlices;n=new Float32Array(a.length*m+3);i=[0,0];f=i[0];for(i=i[1];f<a.length+3;){e=function(){var b,d,c,e;c=[0,2,3,5,6,8];e=[];b=0;for(d=c.length;b<d;b++)j=c[b],e.push((f+j)%a.length);return e}();c=a.subarray(e[0],e[1]+1);b=a.subarray(e[2],
e[3]+1);e=a.subarray(e[4],e[5]+1);k=vec3.create(c);o=vec3.create(b);vec3.lerp(k,b,0.5);vec3.lerp(o,e,0.5);p=vec3.create(k);q=vec3.create(o);vec3.lerp(p,b,1/3);vec3.lerp(q,b,1/3);b=c=1/(m+1);for(s=0;0<=m?s<m:s>m;0<=m?++s:--s){e=1-b;e=[e*e*e,3*e*e*b,3*e*b*b,b*b*b];g=function(){var a,b,d,c;d=[k,p,q,o];c=[];a=0;for(b=d.length;a<b;a++)l=d[a],c.push(vec3.create(l));return c}();for(d=B=0;4>B;d=++B)vec3.scale(g[d],e[d]);g=g.reduce(function(a,b){return vec3.add(a,b)});vec3.scale(g,this.scale);n.set(g,i);i+=
3;if(i>=n.length)return console.log("B\u00e9zier: generated "+i/3+" points from "+a.length/3+" control points."),n;b+=c}f+=3}};c.prototype.generateTube=function(a){var c,b,e,f,d,i,j,g,n,m,l,k,p,q,o,s;m=this.polygonSides;i=this.generateFrames(a);d=a.length/3;n=new Float32Array(6*d*(m+1));k=[0,0];j=k[0];g=k[1];k=vec3.create();for(l=this.radius;j<d;){q=0;e=function(){var a,c;c=[];for(b=a=0;2>=a;b=++a)c.push(i[b].subarray(3*j,3*j+3));return c}();e=function(){var a,d,f;f=[];a=0;for(d=e.length;a<d;a++)c=
e[a],f.push(function(){var a,d;d=[];for(b=a=0;2>=a;b=++a)d.push(c[b]);return d}());return f}();e=e.reduce(function(a,b){return a.concat(b)});e=mat3.create(e);p=0;for(f=w/m;q<m+1;)o=l*y(p),s=l*A(p),mat3.multiplyVec3(e,[o,s,0],k),k[0]+=a[3*j+0],k[1]+=a[3*j+1],k[2]+=a[3*j+2],n.set(k,g),p=[g+6,q+1,p+f],g=p[0],q=p[1],p=p[2];j++}console.log("GenerateTube: generated "+g+" vertices from a centerline with "+d+" nodes.");g=[0,0];j=g[0];g=g[1];l=vec3.create();for(f=vec3.create();j<d;){for(q=0;q<m+1;)k[0]=n[g+
0],k[1]=n[g+1],k[2]=n[g+2],f[0]=a[3*j+0],f[1]=a[3*j+1],f[2]=a[3*j+2],vec3.direction(k,f,l),n.set(l,g+3),q=[g+6,q+1],g=q[0],q=q[1];j++}return n};c.prototype.generateFrames=function(a){var c,b,e,f,d,i,j,g,n,m,l,k;c=a.length/3;b=new Float32Array(3*c);e=new Float32Array(3*c);f=new Float32Array(3*c);for(d=-1;++d<c;)i=(d+1+this.tangentSmoothness)%(c-1),l=a.subarray(3*d,3*d+3),k=a.subarray(3*i,3*i+3),n=f.subarray(3*d,3*d+3),vec3.direction(l,k,n);g=function(){var a,b;b=[];for(a=0;2>=a;++a)b.push(vec3.create());
return b}();j=g[0];n=g[1];l=g[2];d=function(){var a,b;b=[];for(a=0;2>=a;++a)b.push(vec3.create());return b}();g=d[0];m=d[1];k=d[2];vec3.set(f.subarray(0,3),l);D(l,j);vec3.cross(l,j,n);vec3.normalize(j);vec3.normalize(n);vec3.set(j,b.subarray(0,3));vec3.set(n,e.subarray(0,3));i=[0,1];d=i[0];i=i[1];i=[j,n,l];j=i[0];for(n=i[2];d<c-1;)i=d+1,l=a.subarray(3*d,3*d+3),k=a.subarray(3*i,3*i+3),n=f.subarray(3*d,3*d+3),k=f.subarray(3*i,3*i+3),vec3.cross(k,j,m),vec3.normalize(m),vec3.cross(m,k,g),vec3.set(g,b.subarray(3*
i,3*i+3)),vec3.set(m,e.subarray(3*i,3*i+3)),vec3.set(g,j),++d;return[b,e,f]};return c}();c.TubeGenerator=o;w=2*Math.PI;o=function(){var c,a,h,b;h=["sin","cos","pow","abs"];b=[];c=0;for(a=h.length;c<a;c++)t=h[c],b.push(Math[t]);return b}();A=o[0];y=o[1];z=vec3.dot;D=function(c,a){var h;h=vec3.create([1,0,0]);vec3.cross(c,h,a);0.01>z(a,a)&&(vec3.set(h,[0,1,0]),vec3.cross(c,h,a));return vec3.normalize(a)}}).call(this);
