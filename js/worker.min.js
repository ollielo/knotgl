(function(r,v){"object"===typeof exports?module.exports=v(global):"function"===typeof define&&define.amd?define([],function(){return v(r)}):v(r)})(this,function(r){function v(a){return k=a}function G(){return k="undefined"!==typeof Float32Array?Float32Array:Array}var y={};if("undefined"!=typeof Float32Array){var I=new Float32Array(1),w=new Int32Array(I.buffer);y.invsqrt=function(a){I[0]=a;w[0]=1597463007-(w[0]>>1);var b=I[0];return b*(1.5-0.5*a*b*b)}}else y.invsqrt=function(a){return 1/Math.sqrt(a)};
var k=null;G();var m={create:function(a){var b=new k(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=
b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=Math.sqrt(c*c+d*d+e*e);if(g){if(1===g)return b[0]=c,b[1]=d,b[2]=e,b}else return b[0]=0,b[1]=0,b[2]=0,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;return b},cross:function(a,b,c){c||(c=a);var d=
a[0],e=a[1],a=a[2],g=b[0],f=b[1],b=b[2];c[0]=e*b-a*f;c[1]=a*g-d*b;c[2]=d*f-e*g;return c},length:function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(d*d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);
return d},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)}},n=null,q=new k(4);m.unproject=function(a,b,c,d,e){e||(e=a);n||(n=p.create());var g=n;q[0]=2*(a[0]-d[0])/d[2]-1;q[1]=2*(a[1]-d[1])/d[3]-1;q[2]=2*a[2]-1;q[3]=1;p.multiply(c,b,g);if(!p.inverse(g))return null;p.multiplyVec4(g,q);if(0===q[3])return null;e[0]=q[0]/q[3];e[1]=q[1]/q[3];e[2]=q[2]/q[3];return e};var C=m.create([1,0,0]),i=m.create([0,1,0]),F=m.create([0,0,1]);m.rotationTo=function(a,b,c){c||
(c=h.create());var d=m.dot(a,b),e=m.create();if(1<=d)h.set(s,c);else if(-0.999999>d)m.cross(C,a,e),1E-6>e.length&&m.cross(i,a,e),1E-6>e.length&&m.cross(F,a,e),m.normalize(e),h.fromAxisAngle(e,Math.PI,c);else{var d=Math.sqrt(2*(1+d)),g=1/d;m.cross(a,b,e);c[0]=e[0]*g;c[1]=e[1]*g;c[2]=e[2]*g;c[3]=0.5*d;h.normalize(c)}1<c[3]?c[3]=1:-1>c[3]&&(c[3]=-1);return c};m.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var j={create:function(a){var b=new k(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],
b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0;return b},determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],g=a[7],f=a[8];return a[0]*(f*c-d*g)+a[1]*(-f*b+d*e)+a[2]*(g*b-c*e)},inverse:function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],f=a[4],t=a[5],x=a[6],B=a[7],H=a[8],L=H*f-t*B,h=-H*g+t*x,i=B*g-f*x,z=c*L+d*h+e*i;if(!z)return null;z=1/z;b||(b=j.create());b[0]=L*z;b[1]=(-H*d+e*B)*z;b[2]=(t*d-e*f)*z;b[3]=h*z;b[4]=(H*c-e*x)*z;b[5]=(-t*c+e*g)*z;b[6]=
i*z;b[7]=(-B*c+d*x)*z;b[8]=(f*c-d*g)*z;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],f=a[3],t=a[4],x=a[5],B=a[6],H=a[7],a=a[8],h=b[0],j=b[1],i=b[2],z=b[3],l=b[4],k=b[5],m=b[6],p=b[7],b=b[8];c[0]=h*d+j*f+i*B;c[1]=h*e+j*t+i*H;c[2]=h*g+j*x+i*a;c[3]=z*d+l*f+k*B;c[4]=z*e+l*t+k*H;c[5]=z*g+l*x+k*a;c[6]=m*d+p*f+b*B;c[7]=m*e+p*t+b*H;c[8]=m*g+p*x+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0],b=b[1];c[0]=d*a[0]+b*a[3]+a[6];c[1]=d*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,
b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=d*a[0]+e*a[3]+b*a[6];c[1]=d*a[1]+e*a[4]+b*a[7];c[2]=d*a[2]+e*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a||(a=j.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=
a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=p.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},p={create:function(a){var b=new k(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=
a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=p.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||
a===b){var c=a[1],d=a[2],e=a[3],g=a[6],f=a[7],t=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=g;a[11]=a[14];a[12]=e;a[13]=f;a[14]=t;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=a[4],f=a[5],t=a[6],x=a[7],B=a[8],H=a[9],h=a[10],j=a[11],i=a[12],z=a[13],l=a[14],a=a[15];return i*
H*t*e-B*z*t*e-i*f*h*e+g*z*h*e+B*f*l*e-g*H*l*e-i*H*d*x+B*z*d*x+i*c*h*x-b*z*h*x-B*c*l*x+b*H*l*x+i*f*d*j-g*z*d*j-i*c*t*j+b*z*t*j+g*c*l*j-b*f*l*j-B*f*d*a+g*H*d*a+B*c*t*a-b*H*t*a-g*c*h*a+b*f*h*a},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=a[4],t=a[5],x=a[6],B=a[7],h=a[8],j=a[9],i=a[10],l=a[11],z=a[12],k=a[13],m=a[14],p=a[15],s=c*t-d*f,n=c*x-e*f,C=c*B-g*f,E=d*x-e*t,F=d*B-g*t,q=e*B-g*x,D=h*k-j*z,u=h*m-i*z,r=h*p-l*z,w=j*m-i*k,y=j*p-l*k,v=i*p-l*m,A=s*v-n*y+C*w+E*r-F*u+q*D;if(!A)return null;
A=1/A;b[0]=(t*v-x*y+B*w)*A;b[1]=(-d*v+e*y-g*w)*A;b[2]=(k*q-m*F+p*E)*A;b[3]=(-j*q+i*F-l*E)*A;b[4]=(-f*v+x*r-B*u)*A;b[5]=(c*v-e*r+g*u)*A;b[6]=(-z*q+m*C-p*n)*A;b[7]=(h*q-i*C+l*n)*A;b[8]=(f*y-t*r+B*D)*A;b[9]=(-c*y+d*r-g*D)*A;b[10]=(z*F-k*C+p*s)*A;b[11]=(-h*F+j*C-l*s)*A;b[12]=(-f*w+t*u-x*D)*A;b[13]=(c*w-d*u+e*D)*A;b[14]=(-z*E+k*n-m*s)*A;b[15]=(h*E-j*n+i*s)*A;return b},toRotationMat:function(a,b){b||(b=p.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];
b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=j.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],d=a[1],e=a[2],g=a[4],f=a[5],t=a[6],x=a[8],h=a[9],i=a[10],l=i*f-t*h,k=-i*g+t*x,m=h*g-f*x,p=c*l+d*k+e*m;if(!p)return null;p=1/p;b||(b=j.create());b[0]=l*p;b[1]=(-i*d+e*h)*p;b[2]=(t*d-e*f)*p;b[3]=k*p;b[4]=(i*c-e*x)*p;b[5]=(-t*c+e*g)*p;b[6]=m*p;b[7]=
(-h*c+d*x)*p;b[8]=(f*c-d*g)*p;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],f=a[3],t=a[4],x=a[5],h=a[6],i=a[7],j=a[8],l=a[9],p=a[10],k=a[11],m=a[12],s=a[13],n=a[14],a=a[15],C=b[0],E=b[1],F=b[2],q=b[3],D=b[4],u=b[5],r=b[6],w=b[7],y=b[8],v=b[9],G=b[10],I=b[11],A=b[12],J=b[13],K=b[14],b=b[15];c[0]=C*d+E*t+F*j+q*m;c[1]=C*e+E*x+F*l+q*s;c[2]=C*g+E*h+F*p+q*n;c[3]=C*f+E*i+F*k+q*a;c[4]=D*d+u*t+r*j+w*m;c[5]=D*e+u*x+r*l+w*s;c[6]=D*g+u*h+r*p+w*n;c[7]=D*f+u*i+r*k+w*a;c[8]=y*d+v*t+G*j+I*
m;c[9]=y*e+v*x+G*l+I*s;c[10]=y*g+v*h+G*p+I*n;c[11]=y*f+v*i+G*k+I*a;c[12]=A*d+J*t+K*j+b*m;c[13]=A*e+J*x+K*l+b*s;c[14]=A*g+J*h+K*p+b*n;c[15]=A*f+J*i+K*k+b*a;return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var d=b[0],e=b[1],g=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*g+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*g+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*g+a[14]*
b;c[3]=a[3]*d+a[7]*e+a[11]*g+a[15]*b;return c},translate:function(a,b,c){var d=b[0],e=b[1],b=b[2],g,f,t,h,i,j,l,p,k,m,s,n;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;g=a[0];f=a[1];t=a[2];h=a[3];i=a[4];j=a[5];l=a[6];p=a[7];k=a[8];m=a[9];s=a[10];n=a[11];c[0]=g;c[1]=f;c[2]=t;c[3]=h;c[4]=i;c[5]=j;c[6]=l;c[7]=p;c[8]=k;c[9]=m;c[10]=s;c[11]=n;c[12]=g*d+i*e+k*b+a[12];c[13]=f*d+j*e+m*b+a[13];c[14]=
t*d+l*e+s*b+a[14];c[15]=h*d+p*e+n*b+a[15];return c},scale:function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},rotate:function(a,b,c,d){var e=c[0],g=c[1],c=c[2],f=Math.sqrt(e*e+g*g+c*c),t,
h,i,j,l,p,k,m,s,n,C,E,F,q,D,u,r,w,y,v;if(!f)return null;1!==f&&(f=1/f,e*=f,g*=f,c*=f);t=Math.sin(b);h=Math.cos(b);i=1-h;b=a[0];f=a[1];j=a[2];l=a[3];p=a[4];k=a[5];m=a[6];s=a[7];n=a[8];C=a[9];E=a[10];F=a[11];q=e*e*i+h;D=g*e*i+c*t;u=c*e*i-g*t;r=e*g*i-c*t;w=g*g*i+h;y=c*g*i+e*t;v=e*c*i+g*t;e=g*c*i-e*t;g=c*c*i+h;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*q+p*D+n*u;d[1]=f*q+k*D+C*u;d[2]=j*q+m*D+E*u;d[3]=l*q+s*D+F*u;d[4]=b*r+p*w+n*y;d[5]=f*r+k*w+C*y;d[6]=j*r+m*w+E*y;d[7]=l*r+s*
w+F*y;d[8]=b*v+p*e+n*g;d[9]=f*v+k*e+C*g;d[10]=j*v+m*e+E*g;d[11]=l*v+s*e+F*g;return d},rotateX:function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[4],g=a[5],f=a[6],t=a[7],h=a[8],i=a[9],j=a[10],l=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+h*d;c[5]=g*b+i*d;c[6]=f*b+j*d;c[7]=t*b+l*d;c[8]=e*-d+h*b;c[9]=g*-d+i*b;c[10]=f*-d+j*b;c[11]=t*-d+l*b;return c},rotateY:function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],g=a[1],f=a[2],h=
a[3],i=a[8],j=a[9],l=a[10],p=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+i*-d;c[1]=g*b+j*-d;c[2]=f*b+l*-d;c[3]=h*b+p*-d;c[8]=e*d+i*b;c[9]=g*d+j*b;c[10]=f*d+l*b;c[11]=h*d+p*b;return c},rotateZ:function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],g=a[1],f=a[2],h=a[3],i=a[4],j=a[5],l=a[6],p=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+i*d;c[1]=g*b+j*
d;c[2]=f*b+l*d;c[3]=h*b+p*d;c[4]=e*-d+i*b;c[5]=g*-d+j*b;c[6]=f*-d+l*b;c[7]=h*-d+p*b;return c},frustum:function(a,b,c,d,e,g,f){f||(f=p.create());var h=b-a,i=d-c,j=g-e;f[0]=2*e/h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*e/i;f[6]=0;f[7]=0;f[8]=(b+a)/h;f[9]=(d+c)/i;f[10]=-(g+e)/j;f[11]=-1;f[12]=0;f[13]=0;f[14]=-(2*g*e)/j;f[15]=0;return f},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return p.frustum(-b,b,-a,a,c,d,e)},ortho:function(a,b,c,d,e,g,f){f||(f=p.create());var h=b-a,i=d-c,j=g-e;
f[0]=2/h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2/i;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=-2/j;f[11]=0;f[12]=-(a+b)/h;f[13]=-(d+c)/i;f[14]=-(g+e)/j;f[15]=1;return f},lookAt:function(a,b,c,d){d||(d=p.create());var e,g,f,h,i,j,l,k,m=a[0],s=a[1],a=a[2];f=c[0];h=c[1];g=c[2];l=b[0];c=b[1];e=b[2];if(m===l&&s===c&&a===e)return p.identity(d);b=m-l;c=s-c;l=a-e;k=1/Math.sqrt(b*b+c*c+l*l);b*=k;c*=k;l*=k;e=h*l-g*c;g=g*b-f*l;f=f*c-h*b;(k=Math.sqrt(e*e+g*g+f*f))?(k=1/k,e*=k,g*=k,f*=k):f=g=e=0;h=c*f-l*g;i=l*e-b*f;j=b*g-c*
e;(k=Math.sqrt(h*h+i*i+j*j))?(k=1/k,h*=k,i*=k,j*=k):j=i=h=0;d[0]=e;d[1]=h;d[2]=b;d[3]=0;d[4]=g;d[5]=i;d[6]=c;d[7]=0;d[8]=f;d[9]=j;d[10]=l;d[11]=0;d[12]=-(e*m+g*s+f*a);d[13]=-(h*m+i*s+j*a);d[14]=-(b*m+c*s+l*a);d[15]=1;return d},fromRotationTranslation:function(a,b,c){c||(c=p.create());var d=a[0],e=a[1],g=a[2],f=a[3],h=d+d,i=e+e,j=g+g,a=d*h,l=d*i,d=d*j,k=e*i,e=e*j,g=g*j,h=f*h,i=f*i,f=f*j;c[0]=1-(k+g);c[1]=l+f;c[2]=d-i;c[3]=0;c[4]=l-f;c[5]=1-(a+g);c[6]=e+h;c[7]=0;c[8]=d+i;c[9]=e-h;c[10]=1-(a+k);c[11]=
0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},h={create:function(a){var b=new k(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=h.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},s=h.identity();h.calculateW=
function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};h.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],c=(c=c*c+d*d+e*e+g*g)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};h.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=
-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};h.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};h.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=Math.sqrt(c*c+d*d+e*e+g*g);if(0===f)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;b[3]=g*f;return b};h.add=function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};
h.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],a=a[3],f=b[0],h=b[1],i=b[2],b=b[3];c[0]=d*b+a*f+e*i-g*h;c[1]=e*b+a*h+g*f-d*i;c[2]=g*b+a*i+d*h-e*f;c[3]=a*b-d*f-e*h-g*i;return c};h.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],g=b[2],b=a[0],f=a[1],h=a[2],a=a[3],i=a*d+f*g-h*e,j=a*e+h*d-b*g,l=a*g+b*e-f*d,d=-b*d-f*e-h*g;c[0]=i*a+d*-b+j*-h-l*-f;c[1]=j*a+d*-f+l*-b-i*-h;c[2]=l*a+d*-h+i*-f-j*-b;return c};h.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=
a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};h.toMat3=function(a,b){b||(b=j.create());var c=a[0],d=a[1],e=a[2],g=a[3],f=c+c,h=d+d,i=e+e,l=c*f,k=c*h,c=c*i,p=d*h,d=d*i,e=e*i,f=g*f,h=g*h,g=g*i;b[0]=1-(p+e);b[1]=k+g;b[2]=c-h;b[3]=k-g;b[4]=1-(l+e);b[5]=d+f;b[6]=c+h;b[7]=d-f;b[8]=1-(l+p);return b};h.toMat4=function(a,b){b||(b=p.create());var c=a[0],d=a[1],e=a[2],g=a[3],f=c+c,h=d+d,i=e+e,j=c*f,l=c*h,c=c*i,k=d*h,d=d*i,e=e*i,f=g*f,h=g*h,g=g*i;b[0]=1-(k+e);b[1]=l+g;b[2]=c-h;b[3]=0;b[4]=l-g;b[5]=1-(j+
e);b[6]=d+f;b[7]=0;b[8]=c+h;b[9]=d-f;b[10]=1-(j+k);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};h.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],g,f;if(1<=Math.abs(e))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;g=Math.acos(e);f=Math.sqrt(1-e*e);if(0.0010>Math.abs(f))return d[0]=0.5*a[0]+0.5*b[0],d[1]=0.5*a[1]+0.5*b[1],d[2]=0.5*a[2]+0.5*b[2],d[3]=0.5*a[3]+0.5*b[3],d;e=Math.sin((1-c)*g)/f;c=Math.sin(c*g)/f;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=
a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};h.fromRotationMatrix=function(a,b){b||(b=h.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=0.5*d,d=0.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=h.fromRotationMatrix.s_iNext=h.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var e=d[c],g=d[e];d=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*g+g]+1);b[c]=0.5*d;d=0.5/d;b[3]=(a[3*g+e]-a[3*e+g])*d;b[e]=(a[3*e+c]+a[3*c+e])*d;b[g]=(a[3*g+c]+a[3*c+g])*d}return b};
j.toQuat4=h.fromRotationMatrix;var l=j.create();h.fromAxes=function(a,b,c,d){l[0]=b[0];l[3]=b[1];l[6]=b[2];l[1]=c[0];l[4]=c[1];l[7]=c[2];l[2]=a[0];l[5]=a[1];l[8]=a[2];return h.fromRotationMatrix(l,d)};h.identity=function(a){a||(a=h.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};h.fromAngleAxis=function(a,b,c){c||(c=h.create());var a=0.5*a,d=Math.sin(a);c[3]=Math.cos(a);c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};h.toAngleAxis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=
2*Math.acos(a[3]),c=y.invsqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};h.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var E={create:function(a){var b=new k(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},divide:function(a,
b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=
a;return c},length:function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],a=a[1]-b[1],b=d*d+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}},D={create:function(a){var b=new k(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=
b[2]=b[3]=0;return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=D.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1];a[1]=a[2];a[2]=c;return a}b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=c*g-e*d;if(!f)return null;f=1/f;b[0]=g*f;b[1]=-d*f;b[2]=-e*f;b[3]=c*f;return b},multiply:function(a,
b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],a=a[3];c[0]=d*b[0]+e*b[2];c[1]=d*b[1]+e*b[3];c[2]=g*b[0]+a*b[2];c[3]=g*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],a=a[3],f=Math.sin(b),b=Math.cos(b);c[0]=d*b+e*f;c[1]=d*-f+e*b;c[2]=g*b+a*f;c[3]=g*-f+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0],b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=a[1],e=a[2],g=a[3],f=b[0],b=b[1];c[0]=a[0]*f;c[1]=d*b;c[2]=e*f;c[3]=g*b;
return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}},u={create:function(a){var b=new k(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},
divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},str:function(a){return"["+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};r&&(r.glMatrixArrayType=k,r.MatrixArray=k,r.setMatrixArrayType=v,r.determineMatrixArrayType=G,r.glMath=y,r.vec2=E,r.vec3=m,r.vec4=u,r.mat2=D,r.mat3=j,r.mat4=p,r.quat4=h);return{glMatrixArrayType:k,MatrixArray:k,setMatrixArrayType:v,determineMatrixArrayType:G,glMath:y,vec2:E,vec3:m,vec4:u,mat2:D,mat3:j,mat4:p,quat4:h}});
(function(){var r,v,G,y,I,w;y="undefined"!==typeof exports&&null!==exports?exports:this;var k=function(){this.scale=0.15;this.tangentSmoothness=this.b\u00e9zierSlices=3;this.polygonSides=9;this.radius=0.07};k.prototype.getKnotPath=function(k){var i,m,j,p,h,s,l,n,q,u,a,b,c,d,e;q=this.b\u00e9zierSlices;n=new Float32Array(k.length*q+3);s=[0,0];p=s[0];for(s=s[1];p<k.length+3;){c=b=a=i=void 0;b=[0,2,3,5,6,8];c=[];i=0;for(a=b.length;i<a;i++)j=b[i],c.push((p+j)%k.length);j=c;i=k.subarray(j[0],j[1]+1);m=
k.subarray(j[2],j[3]+1);j=k.subarray(j[4],j[5]+1);i=vec3.create(i);c=vec3.create(m);vec3.lerp(i,m,0.5);vec3.lerp(c,j,0.5);a=vec3.create(i);b=vec3.create(c);vec3.lerp(a,m,1/3);vec3.lerp(b,m,1/3);u=m=1/(q+1);for(d=0;0<=q?d<q:d>q;0<=q?++d:--d){j=1-u;j=[j*j*j,3*j*j*u,3*j*u*u,u*u*u];var g=e=l=void 0,f=void 0,g=[i,a,b,c],f=[];l=0;for(e=g.length;l<e;l++)h=g[l],f.push(vec3.create(h));l=f;for(h=e=0;4>e;h=++e)vec3.scale(l[h],j[h]);l=l.reduce(function(a,b){return vec3.add(a,b)});vec3.scale(l,this.scale);n.set(l,
s);s+=3;if(s>=n.length)return n;u+=m}p+=3}};k.prototype.generateTube=function(k){var i,m,j,p,h,s,l,n,q,u,a,b,c,d,e,g;u=this.polygonSides;p=this.generateFrames(k);h=k.length/3;q=new Float32Array(6*h*(u+1));b=[0,0];l=b[0];n=b[1];b=vec3.create();for(a=this.radius;l<h;){d=0;c=s=void 0;c=[];for(m=s=0;2>=s;m=++s)c.push(p[m].subarray(3*l,3*l+3));j=c;j=function(){var a,b,c;c=[];a=0;for(b=j.length;a<b;a++)i=j[a],c.push(function(){var a,b;b=[];for(m=a=0;2>=a;m=++a)b.push(i[m]);return b}());return c}();j=j.reduce(function(a,
b){return a.concat(b)});j=mat3.create(j);c=0;for(s=r/u;d<u+1;)e=a*v(c),g=a*w(c),mat3.multiplyVec3(j,[e,g,0],b),b[0]+=k[3*l+0],b[1]+=k[3*l+1],b[2]+=k[3*l+2],q.set(b,n),c=[n+6,d+1,c+s],n=c[0],d=c[1],c=c[2];l++}n=[0,0];l=n[0];n=n[1];a=vec3.create();for(p=vec3.create();l<h;){for(d=0;d<u+1;)b[0]=q[n+0],b[1]=q[n+1],b[2]=q[n+2],p[0]=k[3*l+0],p[1]=k[3*l+1],p[2]=k[3*l+2],vec3.direction(b,p,a),q.set(a,n+3),d=[n+6,d+1],n=d[0],d=d[1];l++}return q};k.prototype.generateFrames=function(k){var i,m,j,p,h,n,l,q,r,
u;i=k.length/3;m=new Float32Array(3*i);j=new Float32Array(3*i);p=new Float32Array(3*i);for(h=-1;++h<i;)n=(h+1+this.tangentSmoothness)%(i-1),l=k.subarray(3*h,3*h+3),r=k.subarray(3*n,3*n+3),q=p.subarray(3*h,3*h+3),vec3.direction(l,r,q);q=[];for(l=0;2>=l;++l)q.push(vec3.create());l=q[0];h=q[1];n=q[2];r=[];for(q=0;2>=q;++q)r.push(vec3.create());q=r[0];r=r[1];vec3.set(p.subarray(0,3),n);I(n,l);vec3.cross(n,l,h);vec3.normalize(l);vec3.normalize(h);vec3.set(l,m.subarray(0,3));vec3.set(h,j.subarray(0,3));
for(h=0;h<i-1;)n=h+1,k.subarray(3*h,3*h+3),k.subarray(3*n,3*n+3),p.subarray(3*h,3*h+3),u=p.subarray(3*n,3*n+3),vec3.cross(u,l,r),vec3.normalize(r),vec3.cross(r,u,q),vec3.set(q,m.subarray(3*n,3*n+3)),vec3.set(r,j.subarray(3*n,3*n+3)),vec3.set(q,l),++h;return[m,j,p]};y.TubeGenerator=k;r=2*Math.PI;var m,n,q;n=["sin","cos","pow","abs"];q=[];k=0;for(m=n.length;k<m;k++)y=n[k],q.push(Math[y]);w=q[0];v=q[1];G=vec3.dot;I=function(k,i){var m;m=vec3.create([1,0,0]);vec3.cross(k,m,i);0.01>G(i,i)&&(vec3.set(m,
[0,1,0]),vec3.cross(k,m,i));return vec3.normalize(i)}}).call(this);
(function(){var r,v,G,y,I,w;y=G=w=null;this.onmessage=function(k){var m;null==G&&v();m=k.data;switch(m.command){case "download-spines":return k=r(m.url),y=new Float32Array(k),k={command:"spine-data",data:k,scale:w.scale},this.postMessage(k);case "tessellate-link":var n,q,C,i;C=m.link;i=[];n=0;for(q=C.length;n<q;n++)k=C[n],i.push(I(k));k={command:"mesh-link",id:m.id,meshes:i};return this.postMessage(k)}};v=function(){w=new TubeGenerator;w.polygonSides=10;w.b\u00e9zierSlices=3;w.tangentSmoothness=3;
return G=!0};r=function(k){var m;m=new XMLHttpRequest;m.open("GET",k,!1);m.overrideMimeType("text/plain; charset=x-user-defined");if(k="responseType"in m)m.responseType="arraybuffer";m.send(null);return 200!==m.status?null:k?m.response:m.mozResponseArrayBuffer};I=function(k){var m,n,q,r,i,v,j,p,h,s,k=y.subarray(3*k[0],3*k[0]+3*k[1]),k=w.getKnotPath(k);h=v=w.generateTube(k);r=k.length/3-1;j=w.polygonSides;v=new Uint16Array(4*r*j);i=[0,0];m=i[0];for(i=i[1];m<r*(j+1);){for(n=0;n<j;)q=v.subarray(i+2,
i+4),q[0]=m+n,q[1]=m+n+j+1,n=[i+2,n+1],i=n[0],n=n[1];m+=j+1}for(m=0;m<r*(j+1);){for(n=0;n<j;)q=v.subarray(i+0,i+2),q[0]=m+n,q[1]=m+n+1,n=[i+2,n+1],i=n[0],n=n[1];m+=j+1}r=v;v=new Uint16Array(6*k.length/3*j);n=[0,0,0];m=n[0];i=n[1];for(s=n[2];++m<k.length/3;){for(n=-1;++n<j;)q=(n+1)%j,p=v.subarray(i+0,i+3),p[0]=s+q+j+1,p[1]=s+q,p[2]=s+n,p=v.subarray(i+3,i+6),p[0]=s+n,p[1]=s+n+j+1,p[2]=s+q+j+1,i+=6;s+=j+1}return{tube:h,wireframe:r,triangles:v}}}).call(this);
