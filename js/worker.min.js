(function(s,w){"object"===typeof exports?module.exports=w(global):"function"===typeof define&&define.amd?define([],function(){return w(s)}):w(s)})(this,function(s){function w(a){return u=a}function y(){return u="undefined"!==typeof Float32Array?Float32Array:Array}var x={};(function(){if("undefined"!=typeof Float32Array){var a=new Float32Array(1),b=new Int32Array(a.buffer);x.invsqrt=function(c){a[0]=c;b[0]=1597463007-(b[0]>>1);var d=a[0];return d*(1.5-0.5*c*d*d)}}else x.invsqrt=function(a){return 1/
Math.sqrt(a)}})();var u=null;y();var q={create:function(a){var b=new u(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=
b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(!f)return b[0]=0,b[1]=0,b[2]=0,b;if(1===f)return b[0]=c,b[1]=d,b[2]=e,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b},cross:function(a,b,c){c||(c=a);
var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f;return c},length:function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(d*d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-
a[2]);return d},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)}},m=null,l=new u(4);q.unproject=function(a,b,c,d,e){e||(e=a);m||(m=k.create());var f=m;l[0]=2*(a[0]-d[0])/d[2]-1;l[1]=2*(a[1]-d[1])/d[3]-1;l[2]=2*a[2]-1;l[3]=1;k.multiply(c,b,f);if(!k.inverse(f))return null;k.multiplyVec4(f,l);if(0===l[3])return null;e[0]=l[0]/l[3];e[1]=l[1]/l[3];e[2]=l[2]/l[3];return e};var j=q.create([1,0,0]),n=q.create([0,1,0]),C=q.create([0,0,1]);q.rotationTo=function(a,b,
c){c||(c=h.create());var d=q.dot(a,b),e=q.create();if(1<=d)h.set(z,c);else if(-0.999999>d)q.cross(j,a,e),1.0E-6>e.length&&q.cross(n,a,e),1.0E-6>e.length&&q.cross(C,a,e),q.normalize(e),h.fromAxisAngle(e,Math.PI,c);else{var d=Math.sqrt(2*(1+d)),f=1/d;q.cross(a,b,e);c[0]=e[0]*f;c[1]=e[1]*f;c[2]=e[2]*f;c[3]=0.5*d;h.normalize(c)}1<c[3]?c[3]=1:-1>c[3]&&(c[3]=-1);return c};q.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var i={create:function(a){var b=new u(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],
b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0;return b},determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],f=a[7],g=a[8];return a[0]*(g*c-d*f)+a[1]*(-g*b+d*e)+a[2]*(f*b-c*e)},inverse:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],r=a[5],v=a[6],o=a[7],B=a[8],E=B*g-r*o,h=-B*f+r*v,k=o*f-g*v,F=c*E+d*h+e*k;if(!F)return null;F=1/F;b||(b=i.create());b[0]=E*F;b[1]=(-B*d+e*o)*F;b[2]=(r*d-e*g)*F;b[3]=h*F;b[4]=(B*c-e*v)*F;b[5]=(-r*c+e*
f)*F;b[6]=k*F;b[7]=(-o*c+d*v)*F;b[8]=(g*c-d*f)*F;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],r=a[4],v=a[5],o=a[6],B=a[7],a=a[8],E=b[0],h=b[1],i=b[2],k=b[3],j=b[4],l=b[5],n=b[6],p=b[7],b=b[8];c[0]=E*d+h*g+i*o;c[1]=E*e+h*r+i*B;c[2]=E*f+h*v+i*a;c[3]=k*d+j*g+l*o;c[4]=k*e+j*r+l*B;c[5]=k*f+j*v+l*a;c[6]=n*d+p*g+b*o;c[7]=n*e+p*r+b*B;c[8]=n*f+p*v+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0],b=b[1];c[0]=d*a[0]+b*a[3]+a[6];c[1]=d*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,
b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=d*a[0]+e*a[3]+b*a[6];c[1]=d*a[1]+e*a[4]+b*a[7];c[2]=d*a[2]+e*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a||(a=i.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=
a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=k.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},k={create:function(a){var b=new u(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=
a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=k.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||
a===b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],r=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=e;a[13]=g;a[14]=r;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],r=a[6],v=a[7],o=a[8],B=a[9],E=a[10],h=a[11],i=a[12],k=a[13],j=a[14],a=a[15];return i*
B*r*e-o*k*r*e-i*g*E*e+f*k*E*e+o*g*j*e-f*B*j*e-i*B*d*v+o*k*d*v+i*c*E*v-b*k*E*v-o*c*j*v+b*B*j*v+i*g*d*h-f*k*d*h-i*c*r*h+b*k*r*h+f*c*j*h-b*g*j*h-o*g*d*a+f*B*d*a+o*c*r*a-b*B*r*a-f*c*E*a+b*g*E*a},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],r=a[5],v=a[6],o=a[7],B=a[8],h=a[9],i=a[10],k=a[11],j=a[12],l=a[13],n=a[14],p=a[15],z=c*r-d*g,C=c*v-e*g,t=c*o-f*g,D=d*v-e*r,m=d*o-f*r,q=e*o-f*v,s=B*l-h*j,u=B*n-i*j,G=B*p-k*j,w=h*n-i*l,x=h*p-k*l,y=i*p-k*n,A=z*y-C*x+t*w+D*G-m*u+q*s;if(!A)return null;
A=1/A;b[0]=(r*y-v*x+o*w)*A;b[1]=(-d*y+e*x-f*w)*A;b[2]=(l*q-n*m+p*D)*A;b[3]=(-h*q+i*m-k*D)*A;b[4]=(-g*y+v*G-o*u)*A;b[5]=(c*y-e*G+f*u)*A;b[6]=(-j*q+n*t-p*C)*A;b[7]=(B*q-i*t+k*C)*A;b[8]=(g*x-r*G+o*s)*A;b[9]=(-c*x+d*G-f*s)*A;b[10]=(j*m-l*t+p*z)*A;b[11]=(-B*m+h*t-k*z)*A;b[12]=(-g*w+r*u-v*s)*A;b[13]=(c*w-d*u+e*s)*A;b[14]=(-j*D+l*C-n*z)*A;b[15]=(B*D-h*C+i*z)*A;return b},toRotationMat:function(a,b){b||(b=k.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];
b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=i.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],r=a[6],v=a[8],o=a[9],h=a[10],k=h*g-r*o,j=-h*f+r*v,l=o*f-g*v,n=c*k+d*j+e*l;if(!n)return null;n=1/n;b||(b=i.create());b[0]=k*n;b[1]=(-h*d+e*o)*n;b[2]=(r*d-e*g)*n;b[3]=j*n;b[4]=(h*c-e*v)*n;b[5]=(-r*c+e*f)*n;b[6]=l*n;b[7]=
(-o*c+d*v)*n;b[8]=(g*c-d*f)*n;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],r=a[4],v=a[5],o=a[6],h=a[7],k=a[8],i=a[9],j=a[10],n=a[11],l=a[12],p=a[13],z=a[14],a=a[15],C=b[0],t=b[1],D=b[2],m=b[3],q=b[4],s=b[5],u=b[6],w=b[7],x=b[8],y=b[9],H=b[10],I=b[11],A=b[12],J=b[13],K=b[14],b=b[15];c[0]=C*d+t*r+D*k+m*l;c[1]=C*e+t*v+D*i+m*p;c[2]=C*f+t*o+D*j+m*z;c[3]=C*g+t*h+D*n+m*a;c[4]=q*d+s*r+u*k+w*l;c[5]=q*e+s*v+u*i+w*p;c[6]=q*f+s*o+u*j+w*z;c[7]=q*g+s*h+u*n+w*a;c[8]=x*d+y*r+H*k+I*
l;c[9]=x*e+y*v+H*i+I*p;c[10]=x*f+y*o+H*j+I*z;c[11]=x*g+y*h+H*n+I*a;c[12]=A*d+J*r+K*k+b*l;c[13]=A*e+J*v+K*i+b*p;c[14]=A*f+J*o+K*j+b*z;c[15]=A*g+J*h+K*n+b*a;return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*
b;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*b;return c},translate:function(a,b,c){var d=b[0],e=b[1],b=b[2],f,g,r,v,o,h,k,i,j,n,l,p;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];r=a[2];v=a[3];o=a[4];h=a[5];k=a[6];i=a[7];j=a[8];n=a[9];l=a[10];p=a[11];c[0]=f;c[1]=g;c[2]=r;c[3]=v;c[4]=o;c[5]=h;c[6]=k;c[7]=i;c[8]=j;c[9]=n;c[10]=l;c[11]=p;c[12]=f*d+o*e+j*b+a[12];c[13]=g*d+h*e+n*b+a[13];c[14]=
r*d+k*e+l*b+a[14];c[15]=v*d+i*e+p*b+a[15];return c},scale:function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},rotate:function(a,b,c,d){var e=c[0],f=c[1],c=c[2],g=Math.sqrt(e*e+f*f+c*c),r,
h,o,k,i,j,n,l,p,z,C,t,D,m,q,s,u,w,x,y;if(!g)return null;1!==g&&(g=1/g,e*=g,f*=g,c*=g);r=Math.sin(b);h=Math.cos(b);o=1-h;b=a[0];g=a[1];k=a[2];i=a[3];j=a[4];n=a[5];l=a[6];p=a[7];z=a[8];C=a[9];t=a[10];D=a[11];m=e*e*o+h;q=f*e*o+c*r;s=c*e*o-f*r;u=e*f*o-c*r;w=f*f*o+h;x=c*f*o+e*r;y=e*c*o+f*r;e=f*c*o-e*r;f=c*c*o+h;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*m+j*q+z*s;d[1]=g*m+n*q+C*s;d[2]=k*m+l*q+t*s;d[3]=i*m+p*q+D*s;d[4]=b*u+j*w+z*x;d[5]=g*u+n*w+C*x;d[6]=k*u+l*w+t*x;d[7]=i*u+p*
w+D*x;d[8]=b*y+j*e+z*f;d[9]=g*y+n*e+C*f;d[10]=k*y+l*e+t*f;d[11]=i*y+p*e+D*f;return d},rotateX:function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[4],f=a[5],g=a[6],r=a[7],h=a[8],o=a[9],k=a[10],i=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+h*d;c[5]=f*b+o*d;c[6]=g*b+k*d;c[7]=r*b+i*d;c[8]=e*-d+h*b;c[9]=f*-d+o*b;c[10]=g*-d+k*b;c[11]=r*-d+i*b;return c},rotateY:function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],h=
a[3],k=a[8],o=a[9],i=a[10],j=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+k*-d;c[1]=f*b+o*-d;c[2]=g*b+i*-d;c[3]=h*b+j*-d;c[8]=e*d+k*b;c[9]=f*d+o*b;c[10]=g*d+i*b;c[11]=h*d+j*b;return c},rotateZ:function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],k=a[4],o=a[5],i=a[6],j=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+k*d;c[1]=f*b+o*
d;c[2]=g*b+i*d;c[3]=h*b+j*d;c[4]=e*-d+k*b;c[5]=f*-d+o*b;c[6]=g*-d+i*b;c[7]=h*-d+j*b;return c},frustum:function(a,b,c,d,e,f,g){g||(g=k.create());var h=b-a,i=d-c,o=f-e;g[0]=2*e/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*e/i;g[6]=0;g[7]=0;g[8]=(b+a)/h;g[9]=(d+c)/i;g[10]=-(f+e)/o;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(2*f*e)/o;g[15]=0;return g},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return k.frustum(-b,b,-a,a,c,d,e)},ortho:function(a,b,c,d,e,f,g){g||(g=k.create());var h=b-a,i=d-c,o=f-e;
g[0]=2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2/i;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2/o;g[11]=0;g[12]=-(a+b)/h;g[13]=-(d+c)/i;g[14]=-(f+e)/o;g[15]=1;return g},lookAt:function(a,b,c,d){d||(d=k.create());var e,f,g,h,i,o,j,n,l=a[0],p=a[1],a=a[2];g=c[0];h=c[1];f=c[2];j=b[0];c=b[1];e=b[2];if(l===j&&p===c&&a===e)return k.identity(d);b=l-j;c=p-c;j=a-e;n=1/Math.sqrt(b*b+c*c+j*j);b*=n;c*=n;j*=n;e=h*j-f*c;f=f*b-g*j;g=g*c-h*b;(n=Math.sqrt(e*e+f*f+g*g))?(n=1/n,e*=n,f*=n,g*=n):g=f=e=0;h=c*g-j*f;i=j*e-b*g;o=b*f-c*
e;(n=Math.sqrt(h*h+i*i+o*o))?(n=1/n,h*=n,i*=n,o*=n):o=i=h=0;d[0]=e;d[1]=h;d[2]=b;d[3]=0;d[4]=f;d[5]=i;d[6]=c;d[7]=0;d[8]=g;d[9]=o;d[10]=j;d[11]=0;d[12]=-(e*l+f*p+g*a);d[13]=-(h*l+i*p+o*a);d[14]=-(b*l+c*p+j*a);d[15]=1;return d},fromRotationTranslation:function(a,b,c){c||(c=k.create());var d=a[0],e=a[1],f=a[2],g=a[3],h=d+d,i=e+e,o=f+f,a=d*h,j=d*i,d=d*o,n=e*i,e=e*o,f=f*o,h=g*h,i=g*i,g=g*o;c[0]=1-(n+f);c[1]=j+g;c[2]=d-i;c[3]=0;c[4]=j-g;c[5]=1-(a+f);c[6]=e+h;c[7]=0;c[8]=d+i;c[9]=e-h;c[10]=1-(a+n);c[11]=
0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},h={create:function(a){var b=new u(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=h.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},z=h.identity();h.calculateW=
function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};h.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],c=(c=c*c+d*d+e*e+f*f)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};h.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=
-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};h.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};h.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);if(0===g)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;b[3]=f*g;return b};h.add=function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};
h.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],g=b[0],h=b[1],i=b[2],b=b[3];c[0]=d*b+a*g+e*i-f*h;c[1]=e*b+a*h+f*g-d*i;c[2]=f*b+a*i+d*h-e*g;c[3]=a*b-d*g-e*h-f*i;return c};h.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=a[0],g=a[1],h=a[2],a=a[3],i=a*d+g*f-h*e,j=a*e+h*d-b*f,k=a*f+b*e-g*d,d=-b*d-g*e-h*f;c[0]=i*a+d*-b+j*-h-k*-g;c[1]=j*a+d*-g+k*-b-i*-h;c[2]=k*a+d*-h+i*-g-j*-b;return c};h.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=
a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};h.toMat3=function(a,b){b||(b=i.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,j=e+e,k=c*g,n=c*h,c=c*j,l=d*h,d=d*j,e=e*j,g=f*g,h=f*h,f=f*j;b[0]=1-(l+e);b[1]=n+f;b[2]=c-h;b[3]=n-f;b[4]=1-(k+e);b[5]=d+g;b[6]=c+h;b[7]=d-g;b[8]=1-(k+l);return b};h.toMat4=function(a,b){b||(b=k.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,n=c*h,c=c*i,l=d*h,d=d*i,e=e*i,g=f*g,h=f*h,f=f*i;b[0]=1-(l+e);b[1]=n+f;b[2]=c-h;b[3]=0;b[4]=n-f;b[5]=1-(j+
e);b[6]=d+g;b[7]=0;b[8]=c+h;b[9]=d-g;b[10]=1-(j+l);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};h.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],f,g;if(1<=Math.abs(e))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;f=Math.acos(e);g=Math.sqrt(1-e*e);if(0.001>Math.abs(g))return d[0]=0.5*a[0]+0.5*b[0],d[1]=0.5*a[1]+0.5*b[1],d[2]=0.5*a[2]+0.5*b[2],d[3]=0.5*a[3]+0.5*b[3],d;e=Math.sin((1-c)*f)/g;c=Math.sin(c*f)/g;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=
a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};h.fromRotationMatrix=function(a,b){b||(b=h.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=0.5*d,d=0.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=h.fromRotationMatrix.s_iNext=h.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var e=d[c],f=d[e];d=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*f+f]+1);b[c]=0.5*d;d=0.5/d;b[3]=(a[3*f+e]-a[3*e+f])*d;b[e]=(a[3*e+c]+a[3*c+e])*d;b[f]=(a[3*f+c]+a[3*c+f])*d}return b};
i.toQuat4=h.fromRotationMatrix;(function(){var a=i.create();h.fromAxes=function(b,c,d,e){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=b[0];a[5]=b[1];a[8]=b[2];return h.fromRotationMatrix(a,e)}})();h.identity=function(a){a||(a=h.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};h.fromAngleAxis=function(a,b,c){c||(c=h.create());var a=0.5*a,d=Math.sin(a);c[3]=Math.cos(a);c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};h.toAngleAxis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*
a[2];0<c?(b[3]=2*Math.acos(a[3]),c=x.invsqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};h.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var t={create:function(a){var b=new u(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},
divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;
c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],a=a[1]-b[1],b=d*d+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}},p={create:function(a){var b=new u(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=
a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=p.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1];a[1]=a[2];a[2]=c;return a}b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=c*f-e*d;if(!g)return null;g=1/g;b[0]=f*g;b[1]=-d*g;b[2]=-e*g;b[3]=c*g;return b},
multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3];c[0]=d*b[0]+e*b[2];c[1]=d*b[1]+e*b[3];c[2]=f*b[0]+a*b[2];c[3]=f*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],g=Math.sin(b),b=Math.cos(b);c[0]=d*b+e*g;c[1]=d*-g+e*b;c[2]=f*b+a*g;c[3]=f*-g+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0],b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=a[1],e=a[2],f=a[3],g=b[0],b=b[1];c[0]=a[0]*g;c[1]=d*
b;c[2]=e*g;c[3]=f*b;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}},D={create:function(a){var b=new u(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=
a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},
str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};s&&(s.glMatrixArrayType=u,s.MatrixArray=u,s.setMatrixArrayType=w,s.determineMatrixArrayType=y,s.glMath=x,s.vec2=t,s.vec3=q,s.vec4=D,s.mat2=p,s.mat3=i,s.mat4=k,s.quat4=h);return{glMatrixArrayType:u,MatrixArray:u,setMatrixArrayType:w,determineMatrixArrayType:y,glMath:x,vec2:t,vec3:q,vec4:D,mat2:p,mat3:i,mat4:k,quat4:h}});
(function(){var s,w,y,x,u,q,m,l;m="undefined"!==typeof exports&&null!==exports?exports:this;w=function(){function j(){this.scale=0.15;this.tangentSmoothness=this.b\u00e9zierSlices=3;this.polygonSides=9;this.radius=0.07}j.name="TubeGenerator";j.prototype.getKnotPath=function(j){var l,i,k,h,z,t,p,m,a,b,c,d,e,f,g,r,v;b=this.b\u00e9zierSlices;a=new Float32Array(j.length*b+3);t=[0,0];h=t[0];for(t=t[1];h<j.length+3;){k=function(){var a,b,c,d;c=[0,2,3,5,6,8];d=[];a=0;for(b=c.length;a<b;a++)p=c[a],d.push((h+
p)%j.length);return d}();l=j.subarray(k[0],k[1]+1);i=j.subarray(k[2],k[3]+1);k=j.subarray(k[4],k[5]+1);d=vec3.create(l);g=vec3.create(i);vec3.lerp(d,i,0.5);vec3.lerp(g,k,0.5);e=vec3.create(d);f=vec3.create(g);vec3.lerp(e,i,1/3);vec3.lerp(f,i,1/3);i=l=1/(b+1);for(r=0;0<=b?r<b:r>b;0<=b?++r:--r){k=1-i;k=[k*k*k,3*k*k*i,3*k*i*i,i*i*i];m=function(){var a,b,h,i;h=[d,e,f,g];i=[];a=0;for(b=h.length;a<b;a++)c=h[a],i.push(vec3.create(c));return i}();for(z=v=0;4>v;z=++v)vec3.scale(m[z],k[z]);m=m.reduce(function(a,
b){return vec3.add(a,b)});vec3.scale(m,this.scale);a.set(m,t);t+=3;if(t>=a.length)return a;i+=l}h+=3}};j.prototype.generateTube=function(j){var m,i,k,h,z,t,p,q,a,b,c,d,e,f,g,r;b=this.polygonSides;t=this.generateFrames(j);z=j.length/3;a=new Float32Array(6*z*(b+1));d=[0,0];p=d[0];q=d[1];d=vec3.create();for(c=this.radius;p<z;){f=0;k=function(){var a,b;b=[];for(i=a=0;2>=a;i=++a)b.push(t[i].subarray(3*p,3*p+3));return b}();k=function(){var a,b,c;c=[];a=0;for(b=k.length;a<b;a++)m=k[a],c.push(function(){var a,
b;b=[];for(i=a=0;2>=a;i=++a)b.push(m[i]);return b}());return c}();k=k.reduce(function(a,b){return a.concat(b)});k=mat3.create(k);e=0;for(h=s/b;f<b+1;)g=c*y(e),r=c*l(e),mat3.multiplyVec3(k,[g,r,0],d),d[0]+=j[3*p+0],d[1]+=j[3*p+1],d[2]+=j[3*p+2],a.set(d,q),e=[q+6,f+1,e+h],q=e[0],f=e[1],e=e[2];p++}q=[0,0];p=q[0];q=q[1];c=vec3.create();for(h=vec3.create();p<z;){for(f=0;f<b+1;)d[0]=a[q+0],d[1]=a[q+1],d[2]=a[q+2],h[0]=j[3*p+0],h[1]=j[3*p+1],h[2]=j[3*p+2],vec3.direction(d,h,c),a.set(c,q+3),f=[q+6,f+1],q=
f[0],f=f[1];p++}return a};j.prototype.generateFrames=function(j){var l,i,k,h,m,t,p,s,a,b,c,d;l=j.length/3;i=new Float32Array(3*l);k=new Float32Array(3*l);h=new Float32Array(3*l);for(m=-1;++m<l;)t=(m+1+this.tangentSmoothness)%(l-1),c=j.subarray(3*m,3*m+3),d=j.subarray(3*t,3*t+3),a=h.subarray(3*m,3*m+3),vec3.direction(c,d,a);s=function(){var a,b;b=[];for(a=0;2>=a;++a)b.push(vec3.create());return b}();p=s[0];a=s[1];c=s[2];m=function(){var a,b;b=[];for(a=0;2>=a;++a)b.push(vec3.create());return b}();s=
m[0];b=m[1];d=m[2];vec3.set(h.subarray(0,3),c);q(c,p);vec3.cross(c,p,a);vec3.normalize(p);vec3.normalize(a);vec3.set(p,i.subarray(0,3));vec3.set(a,k.subarray(0,3));t=[0,1];m=t[0];t=t[1];t=[p,a,c];p=t[0];for(a=t[2];m<l-1;)t=m+1,c=j.subarray(3*m,3*m+3),d=j.subarray(3*t,3*t+3),a=h.subarray(3*m,3*m+3),d=h.subarray(3*t,3*t+3),vec3.cross(d,p,b),vec3.normalize(b),vec3.cross(b,d,s),vec3.set(s,i.subarray(3*t,3*t+3)),vec3.set(b,k.subarray(3*t,3*t+3)),vec3.set(s,p),++m;return[i,k,h]};return j}();m.TubeGenerator=
w;s=2*Math.PI;w=function(){var j,l,m,i;m=["sin","cos","pow","abs"];i=[];j=0;for(l=m.length;j<l;j++)u=m[j],i.push(Math[u]);return i}();l=w[0];y=w[1];x=vec3.dot;q=function(j,l){var m;m=vec3.create([1,0,0]);vec3.cross(j,m,l);0.01>x(l,l)&&(vec3.set(m,[0,1,0]),vec3.cross(j,m,l));return vec3.normalize(l)}}).call(this);
(function(){var s,w,y,x,u,q;x=y=q=null;this.onmessage=function(m){var l;null==y&&w();l=m.data;switch(l.command){case "download-spines":return m=s(l.url),x=new Float32Array(m),m={command:"spine-data",data:m,scale:q.scale},this.postMessage(m);case "tessellate-link":var j,n,C,i;C=l.link;i=[];j=0;for(n=C.length;j<n;j++)m=C[j],i.push(u(m));m={command:"mesh-link",id:l.id,meshes:i};return this.postMessage(m)}};w=function(){q=new TubeGenerator;q.polygonSides=10;q.b\u00e9zierSlices=3;q.tangentSmoothness=3;
return y=!0};s=function(m){var l;l=new XMLHttpRequest;l.open("GET",m,!1);l.overrideMimeType("text/plain; charset=x-user-defined");if(m="responseType"in l)l.responseType="arraybuffer";l.send(null);return 200!==l.status?null:m?l.response:l.mozResponseArrayBuffer};u=function(m){var l,j,n,s,i,k,h,u,t,p,m=x.subarray(3*m[0],3*m[0]+3*m[1]),m=q.getKnotPath(m);t=k=q.generateTube(m);s=m.length/3-1;h=q.polygonSides;k=new Uint16Array(4*s*h);i=[0,0];l=i[0];for(i=i[1];l<s*(h+1);){for(j=0;j<h;)n=k.subarray(i+2,
i+4),n[0]=l+j,n[1]=l+j+h+1,j=[i+2,j+1],i=j[0],j=j[1];l+=h+1}for(l=0;l<s*(h+1);){for(j=0;j<h;)n=k.subarray(i+0,i+2),n[0]=l+j,n[1]=l+j+1,j=[i+2,j+1],i=j[0],j=j[1];l+=h+1}s=k;k=new Uint16Array(6*m.length/3*h);j=[0,0,0];l=j[0];i=j[1];for(p=j[2];++l<m.length/3;){for(j=-1;++j<h;)n=(j+1)%h,u=k.subarray(i+0,i+3),u[0]=p+n+h+1,u[1]=p+n,u[2]=p+j,u=k.subarray(i+3,i+6),u[0]=p+j,u[1]=p+j+h+1,u[2]=p+n+h+1,i+=6;p+=h+1}return{tube:t,wireframe:s,triangles:k}}}).call(this);
